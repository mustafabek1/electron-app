<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electron Klavye</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #openKeyboard {
            padding: 10px;
            background: blue;
            color: white;
            border: none;
            cursor: pointer;
            display: block; /* Butonu varsayılan olarak göster */
            margin: 0 auto;
        }
        #textInput {
            padding: 10px;
            width: 80%;
            margin: 0 auto;
            display: none; /* Text input'u varsayılan olarak gizle */
        }
        #saveButton {
            padding: 10px;
            background: green;
            color: white;
            border: none;
            cursor: pointer;
            margin: 10px auto;
            display: none; /* Butonu varsayılan olarak gizle */
        }
        #volume-container {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 200px;
        height: 10px;
        background: #ddd;
        border-radius: 5px;
        user-select: none; /* Sürükleme sırasında metin seçimini engelle */
    }

    #volume-slider {
        position: absolute;
        top: -5px;
        left: 0; /* Başlangıç pozisyonu */
        width: 20px;
        height: 20px;
        background: blue;
        border-radius: 50%;
        cursor: grab;
        touch-action: none; /* Touch olaylarını engelle */
    }

    #volume-slider:active {
        cursor: grabbing;
    }
    </style>
</head>
<body>
    <button id="openKeyboard">Klavye Aç</button>
    <input type="text" id="textInput" placeholder="Buraya yazın...">
    <button id="saveButton">Kayıt Et</button>

    <div id="volume-container">
        <div id="volume-slider"></div>
    </div>

    <script>
        const { ipcRenderer } = require("electron");
        
        const openKeyboardBtn = document.getElementById("openKeyboard");
        const textInput = document.getElementById("textInput");
        const saveButton = document.getElementById("saveButton");

        openKeyboardBtn.addEventListener("click", () => {
            ipcRenderer.send("open-keyboard");
            openKeyboardBtn.style.display = 'none';
            textInput.style.display = 'block';
            saveButton.style.display = 'block';
            textInput.focus();
            
            // Klavye açıldığında localStorage'dan veriyi al ve göster
            const savedText = localStorage.getItem('savedText');
            if (savedText) {
                textInput.value = savedText;
            }
        });

        // Sadece Kayıt Et butonuna tıklandığında localStorage'a kaydet
        saveButton.addEventListener('click', () => {
            localStorage.setItem('savedText', textInput.value);
            alert('Metin başarıyla kaydedildi!');
        });

        // input event listener'ı kaldırıldı çünkü artık otomatik kaydetmeyeceğiz

         // Volume slider için gerekli değişkenler
    const volumeSlider = document.getElementById('volume-slider');
    const volumeContainer = document.getElementById('volume-container');
    let isDragging = false;
    let currentX;
    let initialX;
    let xOffset = 0;

    // Başlangıçta mevcut ses seviyesini al ve slider'ı konumlandır
    async function initializeVolumeSlider() {
        const currentVolume = await ipcRenderer.invoke('get-volume');
        const containerWidth = volumeContainer.offsetWidth - volumeSlider.offsetWidth;
        xOffset = (currentVolume / 100) * containerWidth;
        volumeSlider.style.left = `${xOffset}px`;
    }
    initializeVolumeSlider();

    // Mouse events için event listener'lar
    volumeSlider.addEventListener('mousedown', dragStart);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', dragEnd);

    function dragStart(e) {
        initialX = e.clientX - xOffset;
        if (e.target === volumeSlider) {
            isDragging = true;
        }
    }

    function drag(e) {
        if (isDragging) {
            e.preventDefault();
            currentX = e.clientX - initialX;
            
            // Sınırları kontrol et (0-100 arası)
            const containerWidth = volumeContainer.offsetWidth - volumeSlider.offsetWidth;
            if (currentX < 0) currentX = 0;
            if (currentX > containerWidth) currentX = containerWidth;
            
            xOffset = currentX;
            volumeSlider.style.left = `${currentX}px`;
            
            // Ses seviyesini hesapla ve ayarla (0-100 arası)
            const volumeLevel = Math.round((currentX / containerWidth) * 100);
            ipcRenderer.invoke('set-volume', volumeLevel);
        }
    }

    function dragEnd() {
        isDragging = false;
    }
    </script>
</body>
</html>